---
description: Symfony bundle conventions, SOLID principles, Contract pattern, final readonly architecture
alwaysApply: true
---

# Symfony Bundle Conventions

## Architecture

- `final readonly class` for all services, handlers, processors, voters, listeners, DTOs
- Exceptions: Doctrine entities (not `readonly`), bundle class (not `final`), classes documented for inheritance
- Extension points: interfaces, events, compiler passes, decorators — never inheritance

## AbstractBundle (Symfony 7+/8+)

- Always extend `AbstractBundle`, never `Bundle` with separate Extension/Configuration classes
- `configure()` for config tree, `loadExtension()` for container loading, `prependExtension()` for prepending other bundles
- `DependencyInjection/` folder is unnecessary with AbstractBundle — all DI logic lives in the bundle class
- `$this->getPath()` for bundle root path (replaces `\dirname(__DIR__, 2)`)
- Translations auto-discovered from `<BundlePath>/translations/` (XLIFF format)

## SOLID

- **S**: One class, one responsibility. No "god service".
- **O**: Extensible via events/interfaces/decorators. `final readonly` forces composition.
- **L**: Interfaces are substitutable. No `instanceof` on concrete implementations.
- **I**: Segregated interfaces. One interface = one precise contract.
- **D**: Inject interfaces, never concrete implementations.

## Contract Pattern

- `src/Contract/`: public interfaces of the bundle (BC-safe API)
- Services implement Contract interfaces. Host app type-hints on interfaces.
- Only `Contract/`, events, and DTOs are part of the public semver API.

## Naming

- Bundle class: `{Vendor}{Name}Bundle`, namespace `{Vendor}\{Name}Bundle`
- Config alias (auto-derived, snake_case): service prefix `alias.`, route prefix `alias_`
- Translation domain: `{Vendor}{Name}Bundle` in XLIFF

## Structure

- `src/Contract/`, `src/Event/` always present when applicable
- XML for service definitions when needed (no Yaml dependency). Defaults: `autowire=true autoconfigure=true public=false`
- `translations/` at bundle root for XLIFF files (auto-discovered by Symfony)
- Never extend `AbstractController` — inject specific services

## Dependencies

- Symfony packages: always `^7.0 || ^8.0` (semver, never `7.*|8.*`)
- Only declare actual dependencies. Optional deps in `suggest`.
- Never embed vendor code in `src/`
- Composer `allow-plugins`: configure `infection/extension-installer` and `phpro/grumphp` in `composer.json`

## Anti-Patterns

- Using `Bundle` instead of `AbstractBundle` with separate Extension/Configuration classes
- `new Configuration()` or `new Service()` — always use DI or AbstractBundle built-in methods
- Public services by default, missing service ID prefix, YAML services
- Setter injection, business logic in controller/entity
- Hardcoded parameters instead of `configure()` + env vars
- Symfony constraints `7.*|8.*` instead of `^7.0 || ^8.0`

## Commits

When committing, never reference the agent or any co-author (no Co-authored-by, Signed-off-by from the AI, or similar). Commit messages and metadata must describe only the change, with no self-attribution. Never use `git commit --trailer` or add Co-authored-by to commits.

If the IDE (e.g. Cursor) keeps adding Co-authored-by automatically, add a **commit-msg hook** that strips it: put a script in `scripts/git-hooks/commit-msg` that removes lines matching `Co-authored-by:` (e.g. `grep -v -E '^[[:space:]]*Co-authored-by:' "$1"` into a temp file then replace the message file). Provide `make install-hooks` that copies `scripts/git-hooks/commit-msg` to `.git/hooks/commit-msg` and makes it executable. Document `make install-hooks` in README Contributing so contributors can install it too. This applies to any project where the agent or IDE must not appear in commit history.

## After Every Change — Makefile First

Always use Makefile targets. Never call `vendor/bin/` directly.

- `make cs-fix` — fix code style
- `make phpstan` — static analysis
- `make test` — run tests
- `make quality` — full pipeline (cs-check + phpstan + deptrac + lint + test + infection)
- `make ci` — security-check + quality

## Available Skills

- `symfony-bundle-core`: architecture, scaffolding
- `symfony-bundle-ux`: AssetMapper, Stimulus, Twig/Live Components
- `symfony-bundle-doctrine`: entities, XML mapping
- `symfony-bundle-flex`: Flex recipes
- `symfony-bundle-quality`: Makefile, PHPStan, GrumPHP, Infection, Deptrac, CI
